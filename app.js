import { renderHeader, renderDashboard, renderWorkspace } from './components.js';import { mockResults } from './data.js';const state = {    view: 'home', // home | workspace    category: 'all',    currentTemplateId: null,    isGenerating: false,    selectedModel: 'nano' // nano | pro};const header = document.querySelector('#global-header');const main = document.querySelector('#main-container');// Framer Motion Safe Initializationconst Motion = window.Motion || { animate: () => ({ finished: Promise.resolve() }), stagger: () => 0 };const { animate, stagger } = Motion;function init() {    header.innerHTML = renderHeader();    lucide.createIcons();    render();    // Expose functions to window for HTML onclick attributes    window.navigateTo = navigateTo;    window.filterCategory = filterCategory;    window.generateImage = generateImage;    window.selectModel = selectModel;    window.magicPrompt = magicPrompt;}function render() {    if (state.view === 'home') {        main.innerHTML = renderDashboard(state.category);                // Dashboard Animations        if (document.querySelector("#magic-banner")) {            animate("#magic-banner", { opacity: [0, 1], y: [20, 0] }, { duration: 0.6 });        }                const cards = document.querySelectorAll(".template-card");        if (cards.length > 0) {            animate(".template-card",                 { opacity: [0, 1], y: [30, 0] },                 { delay: stagger(0.05), duration: 0.5, easing: [0.19, 1, 0.22, 1] }            );        }    } else if (state.view === 'workspace') {        main.innerHTML = renderWorkspace(state.currentTemplateId, state.selectedModel);                // Workspace Panel Animation        animate("#workspace-controls",             { x: ["-100%", "0%"], opacity: [0, 1] },             { duration: 0.5, easing: [0.19, 1, 0.22, 1] }        );    }        lucide.createIcons();}async function navigateTo(view, id = null) {    if (view === state.view && id === state.currentTemplateId) return;    // Fade out current view    await animate(main, { opacity: 0 }, { duration: 0.2 }).finished;    state.view = view;    if (id) state.currentTemplateId = id;        window.scrollTo(0, 0);    render();    // Fade in new view    animate(main, { opacity: 1 }, { duration: 0.3 });}async function filterCategory(catId) {    if (state.category === catId) return;        const grid = document.querySelector('.grid');    if (grid) {        await animate(grid, { opacity: 0, y: 10 }, { duration: 0.2 }).finished;    }    state.category = catId;    render();}function selectModel(modelId) {    state.selectedModel = modelId;    render(); // Re-render to update UI state correctly}function magicPrompt() {    const textarea = document.getElementById('prompt-area');    if (!textarea) return;    const prompts = [        "사이버펑크 스타일의 네온 사인이 빛나는 미래 도시 야경, 8k 해상도, 시네마틱 조명.",        "미니멀리즘 스타일의 화이트 톤 인테리어, 자연광이 들어오는 창문, 식물 배치.",        "판타지 풍의 고대 유적지, 신비로운 푸른 안개, 돌로 만든 거대한 조각상.",        "현대적인 핀테크 앱 대시보드, 다크 모드, 그라데이션 그래프, 깔끔한 UI."    ];        textarea.value = "";    textarea.placeholder = "AI가 작성 중...";        let txt = prompts[Math.floor(Math.random() * prompts.length)];    let i = 0;    const typeInterval = setInterval(() => {        if (i < txt.length) {            textarea.value += txt.charAt(i);            i++;        } else {            clearInterval(typeInterval);            textarea.focus();        }    }, 30);}function generateImage() {    const viewerEmpty = document.getElementById('viewer-empty');    const viewerLoading = document.getElementById('viewer-loading');    const viewerResult = document.getElementById('viewer-result');    const resultImg = document.getElementById('result-img');    const btn = document.getElementById('generate-btn');    const terminalOutput = document.getElementById('terminal-output');    if (!viewerEmpty) return;    state.isGenerating = true;        // Hide empty/result, Show loading    viewerEmpty.classList.add('hidden');    viewerResult.classList.add('hidden');    viewerResult.classList.remove('scale-100', 'opacity-100');    viewerResult.classList.add('scale-95', 'opacity-0');        viewerLoading.classList.remove('hidden');    viewerLoading.classList.add('flex');        // Button State    btn.disabled = true;    btn.innerHTML = `<i data-lucide="loader-2" class="w-4 h-4 animate-spin"></i> 처리 중...`;    btn.classList.add('opacity-50', 'cursor-not-allowed');    lucide.createIcons();    // Terminal Simulation    terminalOutput.innerHTML = '';    const logs = [        "> Initializing BananaEngine v4.2...",        "> Loading model weights (FP16)...",        "> Analyzing prompt semantics...",        "> Denoising latent space... [Step 5/20]",        "> Denoising latent space... [Step 15/20]",        "> Applying refinement filter...",        "> Upscaling output to 1024x576...",        "> Render Complete."    ];    let logIndex = 0;    const logInterval = setInterval(() => {        if (logIndex < logs.length) {            const line = document.createElement('div');            line.textContent = logs[logIndex];            terminalOutput.appendChild(line);            terminalOutput.scrollTop = terminalOutput.scrollHeight;            logIndex++;        } else {            clearInterval(logInterval);        }    }, 400);    // Finish Generation    setTimeout(() => {        clearInterval(logInterval);        state.isGenerating = false;                viewerLoading.classList.add('hidden');        viewerLoading.classList.remove('flex');        viewerResult.classList.remove('hidden');                const randomImg = mockResults[Math.floor(Math.random() * mockResults.length)];        resultImg.src = randomImg;                requestAnimationFrame(() => {            viewerResult.classList.remove('scale-95', 'opacity-0');            viewerResult.classList.add('scale-100', 'opacity-100');        });        btn.disabled = false;        btn.innerHTML = `<i data-lucide="sparkles" class="w-4 h-4"></i> 다시 생성하기`;        btn.classList.remove('opacity-50', 'cursor-not-allowed');                lucide.createIcons();    }, 3500);}document.addEventListener('DOMContentLoaded', init);